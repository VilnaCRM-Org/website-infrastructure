version: '3'

tasks:
  init:
    desc: 'Initialize Terraspace'
    cmds:
      - terraspace all init
    silent: false

  validate:
    deps: [init]
    desc: 'Validate Terraform code'
    cmds:
      - terraspace all validate
    silent: false

  format:
    desc: 'Format Terraform code'
    cmds:
      - terraform fmt -recursive
    silent: false

  checkov:
    desc: 'Run checkov'
    cmds:
      - checkov -o junitxml --framework terraform -d ./ > checkov.xml
    silent: false

  tfsec:
    desc: 'Run tfsec'
    cmds:
      - tfsec ./ --format junit --out tfsec-junit.xml
    silent: false

  summary:
    desc: 'Display summary'
    deps: [validate, format, checkov, tfsec]
    cmds:
      - echo "Validation and checks have been completed."
